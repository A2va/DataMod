# Back to surface animation
data merge entity @s {NoAI:0}
playsound minecraft:entity.villager.celebrate master @a
execute positioned as @e[tag=chest_miner,limit=1,sort=nearest] run data merge entity @e[tag=chest_miner,limit=1,sort=nearest] {Motion:[1.0d,0.0d,0.0d]}

# Set Offers by level
data merge entity @s[nbt={VillagerData:{level:2}}] {Offers:{Recipes:[{maxUses:1,buy:{id:"wooden_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:1,display:{Name:'{"text":"Contrat N°1","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (1min) :","italic":false,"color":"gold"}','{"text":"- Coal 40%"}','{"text":"- Cobblestone 60%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"stone_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:2,display:{Name:'{"text":"Contrat N°2","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (2min) :","italic":false,"color":"gold"}','{"text":"- Coal 25%"}','{"text":"- Iron_ore 25%"}','{"text":"- Cobblestone 50%"}']}}},xp:0,rewardExp:0},]}}

data merge entity @s[nbt={VillagerData:{level:3}}] {Offers:{Recipes:[{maxUses:1,buy:{id:"wooden_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:1,display:{Name:'{"text":"Contrat N°1","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (1min) :","italic":false,"color":"gold"}','{"text":"- Coal 40%"}','{"text":"- Cobblestone 60%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"stone_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:2,display:{Name:'{"text":"Contrat N°2","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (2min) :","italic":false,"color":"gold"}','{"text":"- Coal 25%"}','{"text":"- Iron_ore 25%"}','{"text":"- Cobblestone 50%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"iron_pickaxe",Count:1b},buyB:{id:"emerald",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:3,display:{Name:'{"text":"Contrat N°3","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (4min) :","italic":false,"color":"gold"}','{"text":"- Coal 15%"}','{"text":"- Iron_ore 20%"}','{"text":"- Gold_ore 20%"}','{"text":"- Redstone 3%"}','{"text":"- Lapis_lazuli 3%"}','{"text":"- Diamond 2%"}','{"text":"- Emerald 1%"}','{"text":"- Cobblestone 36%"}']}}},xp:0,rewardExp:0},]}}

data merge entity @s[nbt={VillagerData:{level:4}}] {Offers:{Recipes:[{maxUses:1,buy:{id:"wooden_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:1,display:{Name:'{"text":"Contrat N°1","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (1min) :","italic":false,"color":"gold"}','{"text":"- Coal 40%"}','{"text":"- Cobblestone 60%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"stone_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:2,display:{Name:'{"text":"Contrat N°2","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (2min) :","italic":false,"color":"gold"}','{"text":"- Coal 25%"}','{"text":"- Iron_ore 25%"}','{"text":"- Cobblestone 50%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"iron_pickaxe",Count:1b},buyB:{id:"emerald",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:3,display:{Name:'{"text":"Contrat N°3","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (4min) :","italic":false,"color":"gold"}','{"text":"- Coal 15%"}','{"text":"- Iron_ore 20%"}','{"text":"- Gold_ore 20%"}','{"text":"- Redstone 3%"}','{"text":"- Lapis_lazuli 3%"}','{"text":"- Diamond 2%"}','{"text":"- Emerald 1%"}','{"text":"- Cobblestone 36%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"golden_pickaxe",Count:1b},buyB:{id:"emerald",Count:2b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:4,display:{Name:'{"text":"Contrat N°4","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (2min) :","italic":false,"color":"gold"}','{"text":"- Coal 10%"}','{"text":"- Iron_ore 20%"}','{"text":"- Gold_ore 20%"}','{"text":"- Redstone 11%"}','{"text":"- Lapis_lazuli 11%"}','{"text":"- Diamond 5%"}','{"text":"- Emerald 3%"}','{"text":"- Cobblestone 20%"}']}}},xp:0,rewardExp:0},]}}

data merge entity @s[nbt={VillagerData:{level:5}}] {Offers:{Recipes:[{maxUses:1,buy:{id:"wooden_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:1,display:{Name:'{"text":"Contrat N°1","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (1min) :","italic":false,"color":"gold"}','{"text":"- Coal 40%"}','{"text":"- Cobblestone 60%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"stone_pickaxe",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:2,display:{Name:'{"text":"Contrat N°2","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (2min) :","italic":false,"color":"gold"}','{"text":"- Coal 25%"}','{"text":"- Iron_ore 25%"}','{"text":"- Cobblestone 50%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"iron_pickaxe",Count:1b},buyB:{id:"emerald",Count:1b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:3,display:{Name:'{"text":"Contrat N°3","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (4min) :","italic":false,"color":"gold"}','{"text":"- Coal 15%"}','{"text":"- Iron_ore 20%"}','{"text":"- Gold_ore 20%"}','{"text":"- Redstone 3%"}','{"text":"- Lapis_lazuli 3%"}','{"text":"- Diamond 2%"}','{"text":"- Emerald 1%"}','{"text":"- Cobblestone 36%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"golden_pickaxe",Count:1b},buyB:{id:"emerald",Count:2b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:4,display:{Name:'{"text":"Contrat N°4","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (2min) :","italic":false,"color":"gold"}','{"text":"- Coal 10%"}','{"text":"- Iron_ore 20%"}','{"text":"- Gold_ore 20%"}','{"text":"- Redstone 11%"}','{"text":"- Lapis_lazuli 11%"}','{"text":"- Diamond 5%"}','{"text":"- Emerald 3%"}','{"text":"- Cobblestone 20%"}']}}},xp:0,rewardExp:0},{maxUses:1,buy:{id:"diamond_pickaxe",Count:1b},buyB:{id:"emerald",Count:5b},sell:{id:"paper",Count:1b,tag:{kill:1,contrat:5,display:{Name:'{"text":"Contrat N°5","italic":false,"underlined":true}',Lore:['{"text":"Can obtain (10min) :","italic":false,"color":"gold"}','{"text":"- Coal 7%"}','{"text":"- Iron_ore 15%"}','{"text":"- Gold_ore 15%"}','{"text":"- Redstone 15%"}','{"text":"- Lapis_lazuli 15%"}','{"text":"- Diamond 8%"}','{"text":"- Emerald 3%"}','{"text":"- Cobblestone 22%"}']}}},xp:2,rewardExp:0b},]}}


# Place loot chest
execute positioned as @e[tag=chest_loot,limit=1,sort=nearest] if block ~ ~ ~ chest run setblock ~ ~ ~ air
execute positioned as @e[tag=chest_loot,limit=1,sort=nearest] unless block ~ ~ ~ chest run setblock ~ ~ ~ chest

# Generate loot
execute as @s[tag=contrat1] positioned as @e[tag=chest_loot,limit=1,sort=nearest] run loot insert ~ ~ ~ loot jam:chests/miner_loot_1
execute as @s[tag=contrat2] positioned as @e[tag=chest_loot,limit=1,sort=nearest] run loot insert ~ ~ ~ loot jam:chests/miner_loot_2
execute as @s[tag=contrat3] positioned as @e[tag=chest_loot,limit=1,sort=nearest] run loot insert ~ ~ ~ loot jam:chests/miner_loot_3
execute as @s[tag=contrat4] positioned as @e[tag=chest_loot,limit=1,sort=nearest] run loot insert ~ ~ ~ loot jam:chests/miner_loot_4
execute as @s[tag=contrat5] positioned as @e[tag=chest_loot,limit=1,sort=nearest] run loot insert ~ ~ ~ loot jam:chests/miner_loot_5

# Place loot in minecart chest
execute positioned as @e[tag=chest_loot,limit=1,sort=nearest] run data modify entity @e[tag=chest_miner,limit=1,sort=nearest] Items set from block ~ ~ ~ Items
execute positioned as @e[tag=chest_loot,limit=1,sort=nearest] if block ~ ~ ~ chest run setblock ~ ~ ~ dirt

# Reset Villager tags
tag @s remove contrat1
tag @s remove contrat2
tag @s remove contrat3
tag @s remove contrat4
tag @s remove contrat5
tag @s remove EndWork
